build:
  gpu: true
  python_version: "3.12"
  python_packages:
    - "numpy<2"
    - "torch==2.2.2"
    - "torchaudio==2.2.2"
  run:
    - "pip install 'setuptools<82' wheel packaging && pip install --no-build-isolation openai-whisper==20231117 && pip install --no-build-isolation stable-ts==2.16.0"
    # Pre-download Silero VAD into the Docker image so it never hits GitHub at runtime.
    # stable_whisper's vad=True triggers torch.hub.load() which downloads ~30MB from
    # github.com/snakers4/silero-vad â€” if that fails in the container, the worker crashes.
    # Silero VAD now imports `packaging` at load time, so it must be installed first.
    - "python -c \"import torch; torch.hub.load('snakers4/silero-vad', 'silero_vad', trust_repo=True)\""
    # Pre-download Whisper large-v3 weights (~3GB) into the image.
    - "python -c \"import stable_whisper; stable_whisper.load_model('large-v3')\""
  system_packages:
    - "ffmpeg"
predict: "predict.py:Predictor"
